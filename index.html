<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¨</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <meta property="og:image" content="https://raw.githubusercontent.com/cass-0820/Typ_dark/refs/heads/main/2.jpeg">
    <title>í”„ë¡œì íŠ¸ ë¹„ì£¼ì–¼ ë³´ë“œ (Dark Mode)</title>
    <style>
        /* === ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë‹¤í¬ ëª¨ë“œ ì ìš©) === */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
            background-color: #121212; /* ë°°ê²½ìƒ‰ ë³€ê²½ */
            color: #e0e0e0;
            overscroll-behavior: none;
        }

        /* === ìƒë‹¨ íƒ­ === */
        .top-nav {
            height: 45px; background-color: #1e1e1e; display: flex; align-items: flex-end;
            padding: 0 10px; overflow-x: auto; flex-shrink: 0; border-bottom: 1px solid #333; gap: 2px;
            z-index: 1000;
        }
        .top-nav::-webkit-scrollbar { height: 4px; }
        .top-nav::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

        .tab-item {
            padding: 8px 16px; font-size: 13px; font-weight: 500; color: #888;
            background-color: #2c2c2c; border-radius: 8px 8px 0 0; cursor: pointer;
            min-width: 80px; text-align: center; user-select: none; position: relative;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            border: 1px solid #333; border-bottom: none;
        }
        .tab-item:hover { background-color: #383838; color: #ccc; }
        .tab-item.active {
            background-color: #121212; color: #64b5f6; font-weight: bold;
            border-top: 3px solid #64b5f6; border-bottom: 1px solid #121212; z-index: 10;
        }
        .tab-close { font-size: 11px; color: #666; padding: 2px 5px; border-radius: 50%; }
        .tab-close:hover { background-color: #cf6679; color: #fff; }
        .add-tab-btn {
            padding: 6px 12px; background: none; border: none; font-size: 18px;
            color: #888; cursor: pointer; font-weight: bold;
        }

        /* === ë©”ì¸ ì˜ì—­ === */
        .main-container { flex: 1; position: relative; width: 100%; height: 100%; background-color: #121212; overflow: hidden; }

        /* A. í…ìŠ¤íŠ¸ ì—ë””í„° */
        #textEditorArea { display: none; width: 100%; height: 100%; position: relative; }
        textarea#textInput, #markdownPreview {
            width: 100%; height: 100%; border: none; resize: none; outline: none;
            font-size: 17px; line-height: 1.8; color: #e0e0e0; padding: 40px 50px;
            box-sizing: border-box; background: transparent; position: absolute; top:0; left:0;
        }
        #markdownPreview { display: none; z-index: 20; background: #121212; overflow-y: auto; }
        #markdownPreview h1 { border-bottom: 1px solid #333; padding-bottom: 0.3em; margin-top: 1.5em; color: #64b5f6; }
        #markdownPreview h2 { color: #90caf9; }
        #markdownPreview blockquote { border-left: 4px solid #444; padding-left: 1em; color: #aaa; }
        #markdownPreview img { max-width: 100%; border-radius: 8px; border: 1px solid #333; }
        #markdownPreview code { background-color: #2c2c2c; padding: 2px 4px; border-radius: 4px; color: #ffab40; }

        /* B. ë¹„ì£¼ì–¼ ë³´ë“œ */
        #canvasArea {
            display: none; width: 100%; height: 100%; position: relative;
            background-color: #121212;
            background-image: radial-gradient(#333 1.5px, transparent 1.5px); /* ê·¸ë¦¬ë“œ ìƒ‰ìƒ ì¡°ì • */
            background-attachment: local;
            background-size: 24px 24px;
            overflow: auto; 
            -webkit-overflow-scrolling: touch;
        }
        
        #canvasSizer {
            position: absolute; top: 0; left: 0; width: 1px; height: 3000px;
            pointer-events: none; z-index: -1;
        }

        /* ìº”ë²„ìŠ¤ ì•„ì´í…œ */
        .item {
            position: absolute; 
            box-shadow: 4px 4px 15px rgba(0,0,0,0.5); 
            border-radius: 8px; display: flex; flex-direction: column; 
            box-sizing: border-box; cursor: grab; transition: box-shadow 0.2s, border 0.1s;
            padding: 15px; overflow: visible !important;
            touch-action: none;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .item:active { cursor: grabbing; }
        .item.selected { 
            border: 2px solid #64b5f6; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); 
        }

        .tag {
            position: absolute; top: -12px; left: -5px; 
            background: #1b5e20; color: #c8e6c9; /* ë‹¤í¬ê·¸ë¦° íƒœê·¸ */
            font-size: 13px; font-weight: 800; padding: 4px 10px; border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
            pointer-events: none; white-space: nowrap; z-index: 5;
            display: none; 
        }
        .item:not(.selected):not([data-title=""]) .tag { display: block !important; }

        .item-input-title {
            width: 100%; border: none; background: rgba(0,0,0,0.2);
            border-bottom: 2px solid #444; 
            outline: none; font-weight: bold; font-size: 15px; color: #90caf9;
            padding: 5px; margin-bottom: 8px; flex-shrink: 0;
            display: none; cursor: text;
        }
        .item.selected .item-input-title { display: block; }

        .item-textarea {
            flex: 1; width: 100%; border: none; background: transparent; outline: none;
            resize: none; font-size: 15px; line-height: 1.6; font-family: 'Pretendard', sans-serif;
            padding: 0; margin: 0; cursor: text; color: #333; overflow-y: hidden; 
        }
        /* ë©”ëª¨ì§€ ë‚´ë¶€ í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ë°°ê²½ì´ ë°ìœ¼ë¯€ë¡œ ë‹¤í¬ ìœ ì§€) */
        .item[style*="background: transparent"] .item-textarea { color: #e0e0e0; }

        .item img { 
            width: 100%; height: 100%; object-fit: contain; border-radius: 4px;
            pointer-events: none; 
            -webkit-user-drag: none;
        }

        .config-panel {
            position: absolute; top: -48px; left: 0; 
            background: #222; border-radius: 30px; padding: 6px 14px; 
            display: none; gap: 8px; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: default; z-index: 99999;
            white-space: nowrap; border: 1px solid #444;
        }
        .item.selected .config-panel { display: flex; }
        
        .color-dot { width: 18px; height: 18px; border-radius: 50%; cursor: pointer; border: 2px solid #555; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        .config-btn { background: none; border: none; color: #bbb; font-weight: bold; cursor: pointer; font-size: 12px; padding: 2px 4px; border-radius: 4px; }
        .config-btn:hover { background-color: rgba(255,255,255,0.1); color: #fff; }
        .delete-btn { color: #ff8a80; }
        
        .v-sep { width: 1px; height: 12px; background: #444; margin: 0 2px; }

        .resize-handle {
            position: absolute; bottom: -6px; right: -6px; width: 20px; height: 20px;
            background: #333; border: 2px solid #64b5f6; border-radius: 50%;
            cursor: nwse-resize; display: none; z-index: 101;
        }
        .item.selected .resize-handle { display: block; }

        /* ìº”ë²„ìŠ¤ íˆ´ë°” */
        .canvas-toolbar {
            position: fixed; 
            top: 60px; left: 50%; transform: translateX(-50%);
            background: #2c2c2c; padding: 8px 24px; border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4); display: flex; gap: 15px; z-index: 200;
            border: 1px solid #444;
        }
        .canvas-btn { background: none; border: none; font-weight: bold; font-size: 14px; cursor: pointer; color: #aaa; }
        .canvas-btn:hover { color: #64b5f6; }

/* === Tool Box ìŠ¤íƒ€ì¼ ìˆ˜ì • === */
.floating-panel {
    position: absolute; 
    top: 20px; 
    right: 20px; 
    width: 280px; /* ë„ˆë¹„ë¥¼ ëª…í™•í•˜ê²Œ ê³ ì • */
    background-color: rgba(30, 30, 30, 0.85); 
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1); 
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: flex; 
    flex-direction: column; 
    z-index: 300;
    transition: opacity 0.3s ease; 
    opacity: 0.8; 
}

/* ìµœì†Œí™” ë˜ì—ˆì„ ë•Œ ë„ˆë¹„ */
.floating-panel.minimized { 
    width: 140px; 
    height: 34px; 
    overflow: hidden; 
}

.btn-row { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; /* ì•„ì´ì½˜ë“¤ì„ ê· ë“±í•œ ê°„ê²©ìœ¼ë¡œ ë°°ì¹˜ */
    flex-wrap: nowrap; 
    gap: 2px; 
    width: 100%; 
}

.icon-btn {
    background: transparent; 
    border: none; 
    cursor: pointer;
    padding: 8px; 
    border-radius: 8px; 
    color: #999;
    display: flex; 
    align-items: center; 
    justify-content: center;
    transition: all 0.2s; 
    flex: 1; /* ëª¨ë“  ë²„íŠ¼ì´ ë™ì¼í•œ ê°€ë¡œ ê³µê°„ ì°¨ì§€ */
}

.icon-btn:hover { background-color: rgba(255,255,255,0.1); color: #fff; }
.icon-btn.active { background-color: rgba(100, 181, 246, 0.2); color: #64b5f6; }
.icon-btn svg { width: 18px; height: 18px; fill: currentColor; }
        
        #btnResetAll { color: #ff5252; }
        #btnResetAll:hover { background-color: rgba(255, 82, 82, 0.1); color: #ff8a80; }

        .sep { width: 1px; height: 14px; background: #444; margin: 0 2px; }

        .stats-info {
            background-color: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 6px; font-size: 12px; color: #888;
        }
        .stat-line { display: flex; justify-content: space-between; }
        .stat-val { font-weight: bold; color: #bbb; }
        .selection-active { color: #64b5f6; font-weight: bold; }

        .symbol-palette { display: none; grid-template-columns: repeat(6, 1fr); gap: 4px; background-color: #252525; padding: 8px; border-radius: 8px; margin-top: 5px; border: 1px solid #333; }
        .symbol-palette.show { display: grid; }
        .sym-btn { background: #333; border: 1px solid #444; border-radius: 4px; cursor: pointer; padding: 6px 0; font-size: 14px; color: #ccc; }
        .sym-btn:hover { background-color: #444; color: #fff; }

        .toast { visibility: hidden; min-width: 200px; background-color: rgba(255, 255, 255, 0.9); color: #000; text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 1000; left: 50%; bottom: 40px; transform: translateX(-50%); font-size: 14px; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-weight: bold;}
        .toast.show { visibility: visible; opacity: 1; bottom: 60px; }

        #saveIndicator {
            position: fixed; bottom: 15px; right: 15px;
            background-color: rgba(255, 255, 255, 0.15); color: #fff;
            padding: 8px 16px; border-radius: 20px; font-size: 12px;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
            z-index: 2000; font-weight: bold; display: flex; align-items: center; gap: 6px;
        }
        #saveIndicator.saving { opacity: 1; }
        #saveIndicator::before {
            content: ''; width: 8px; height: 8px; border: 2px solid #fff; 
            border-top-color: transparent; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

Â  Â  <div class="top-nav" id="topNav">
Â  Â  Â  Â  <button class="add-tab-btn" id="btnAddTab" title="ìƒˆ ë…¸íŠ¸ ì¶”ê°€">+</button>
Â  Â  </div>

Â  Â  <div class="main-container">
Â  Â  Â  Â  <div id="canvasArea">
Â  Â  Â  Â  Â  Â  <div id="canvasSizer"></div>
Â  Â  Â  Â  Â  Â  <div class="canvas-toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="canvas-btn" onclick="document.getElementById('imgInput').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="width:1px; height:15px; background:#ccc; margin: 0 10px;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="canvas-btn" onclick="addMemoItem()">ğŸ“ ë©”ëª¨ ì¶”ê°€</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="textEditorArea">
Â  Â  Â  Â  Â  Â  <div id="markdownPreview"></div>
Â  Â  Â  Â  Â  Â  <textarea id="textInput" placeholder="ì´ê³³ì— ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="floating-panel" id="floatingPanel">
Â  Â  Â  Â  Â  Â  <div class="panel-header" id="dragHandle">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="drag-label">:: Tool Box</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnMinimize">_</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="panel-content">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="btn-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnSaveJson" title="ì €ì¥"><svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnLoadJson" title="ë¶ˆëŸ¬ì˜¤ê¸°"><svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnResetAll" title="ëª¨ë‘ ì‚­ì œ(ì´ˆê¸°í™”)" onclick="resetAllData()"><svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sep" id="undoSep"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnUndo" title="ì‹¤í–‰ ì·¨ì†Œ"><svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnRedo" title="ë‹¤ì‹œ ì‹¤í–‰"><svg viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></svg></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sep"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnPreview" title="ë¯¸ë¦¬ë³´ê¸°"><svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="icon-btn" id="btnSymbol" title="íŠ¹ìˆ˜ë¬¸ì"><svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="symbol-palette" id="symbolPalette"></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-line"><span>AI í† í°</span><span class="stat-val" id="totalToken">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-line"><span>ê¸€ììˆ˜</span><span class="stat-val" id="totalChar">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-line" id="selectionRow" style="display:none;"><span>ì„ íƒ</span><span class="stat-val selection-active" id="selectChar">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="saveIndicator">ì €ì¥ ì¤‘...</div>

Â  Â  <input type="file" id="imgInput" style="display:none" accept="image/*" onchange="addCanvasImage(this)">
Â  Â  <input type="file" id="fileInput" style="display:none" accept=".json">
Â  Â  <div id="toast" class="toast">ë©”ì‹œì§€</div>

<script>
Â  Â  let pages = [], curPageIndex = 0;
Â  Â  let canvasItems = [], selectedId = null;
Â  Â  let draggedItem = null, resizeItem = null, draggedDOM = null, resizeDOM = null;
Â  Â  let isDragging = false, isPanelDragging = false;Â 
Â  Â  let startX, startY, initialX, initialY, initialW, initialH;
Â  Â  let pStartX, pStartY, pIL, pIT;Â 
Â  Â  let isPreviewMode = false;

Â  Â  // === IndexedDB ì„¤ì • ===
Â  Â  const DB_NAME = 'ProjectBoardDB';
Â  Â  const STORE_NAME = 'pages';
Â  Â  let db = null;
Â  Â  let saveTimeout = null;

Â  Â  const topNav = document.getElementById('topNav'), textEditorArea = document.getElementById('textEditorArea'), canvasArea = document.getElementById('canvasArea');
Â  Â  const textInput = document.getElementById('textInput'), btnAddTab = document.getElementById('btnAddTab'), btnPreview = document.getElementById('btnPreview'), markdownPreview = document.getElementById('markdownPreview'), toast = document.getElementById('toast');
Â  Â  const panel = document.getElementById('floatingPanel'), btnMinimize = document.getElementById('btnMinimize'), dragHandle = document.getElementById('dragHandle');
Â  Â  const saveIndicator = document.getElementById('saveIndicator');

Â  Â  function initDB() {
Â  Â  Â  Â  const request = indexedDB.open(DB_NAME, 1);
Â  Â  Â  Â  request.onupgradeneeded = (e) => {
Â  Â  Â  Â  Â  Â  const d = e.target.result;
Â  Â  Â  Â  Â  Â  if (!d.objectStoreNames.contains(STORE_NAME)) {
Â  Â  Â  Â  Â  Â  Â  Â  d.createObjectStore(STORE_NAME, { keyPath: 'id' });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  request.onsuccess = (e) => {
Â  Â  Â  Â  Â  Â  db = e.target.result;
Â  Â  Â  Â  Â  Â  loadFromDB();Â 
Â  Â  Â  Â  };
Â  Â  Â  Â  request.onerror = (e) => console.error("DB Error", e);
Â  Â  }

Â  Â  function loadFromDB() {
Â  Â  Â  Â  const tx = db.transaction(STORE_NAME, 'readonly');
Â  Â  Â  Â  const store = tx.objectStore(STORE_NAME);
Â  Â  Â  Â  const req = store.get('my_project_data');

Â  Â  Â  Â  req.onsuccess = () => {
Â  Â  Â  Â  Â  Â  if (req.result) {
Â  Â  Â  Â  Â  Â  Â  Â  pages = req.result.data;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const localData = localStorage.getItem('my_project_v3_layer_dots');
Â  Â  Â  Â  Â  Â  Â  Â  if (localData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { pages = JSON.parse(localData); } catch(e) { resetPages(); }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetPages();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(!pages.length) resetPages();
Â  Â  Â  Â  Â  Â  curPageIndex = 0; renderTabs(); loadPage(0);
Â  Â  Â  Â  };
Â  Â  }

Â  Â  // === ë°ì´í„° ì™„ì „ ì´ˆê¸°í™” í•¨ìˆ˜ ===
Â  Â  function resetAllData() {
Â  Â  Â  Â  if(confirm('âš ï¸ ê²½ê³ : ëª¨ë“  ë°ì´í„°(ì‚¬ì§„, ê¸€)ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\nì •ë§ë¡œ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
Â  Â  Â  Â  Â  Â  const req = indexedDB.deleteDatabase(DB_NAME);
Â  Â  Â  Â  Â  Â  req.onsuccess = () => {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('my_project_v3_layer_dots');
Â  Â  Â  Â  Â  Â  Â  Â  alert('ì´ˆê¸°í™” ë˜ì—ˆìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  Â  Â  Â  Â  location.reload();Â 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  req.onerror = () => {
Â  Â  Â  Â  Â  Â  Â  Â  alert('ì´ˆê¸°í™” ì‹¤íŒ¨. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function resetPages() { pages = [{ title: 'ğŸ¨ ë¹„ì£¼ì–¼ ë³´ë“œ', type: 'canvas', content: [] }, { title: 'ğŸ“ ì„¤ì • ë…¸íŠ¸', type: 'text', content: '# í”„ë¡œì íŠ¸ ì„¤ì •\n' }]; }

Â  Â  function saveAll() {
Â  Â  Â  Â  if (curPageIndex === 0) pages[0].content = canvasItems;
Â  Â  Â  Â  else pages[curPageIndex].content = textInput.value;
Â  Â  Â  Â  clearTimeout(saveTimeout);
Â  Â  Â  Â  saveTimeout = setTimeout(executeSave, 500);
Â  Â  }

Â  Â  function executeSave() {
Â  Â  Â  Â  if(!db) return;
Â  Â  Â  Â  saveIndicator.classList.add('saving');
Â  Â  Â  Â  const tx = db.transaction(STORE_NAME, 'readwrite');
Â  Â  Â  Â  const store = tx.objectStore(STORE_NAME);
Â  Â  Â  Â  const req = store.put({ id: 'my_project_data', data: pages });
Â  Â  Â  Â  req.onsuccess = () => { setTimeout(() => { saveIndicator.classList.remove('saving'); }, 500); };
Â  Â  Â  Â  req.onerror = () => { saveIndicator.classList.remove('saving'); };
Â  Â  }

Â  Â  function renderTabs() {
Â  Â  Â  Â  document.querySelectorAll('.tab-item').forEach(e => e.remove());
Â  Â  Â  Â  pages.forEach((page, idx) => {
Â  Â  Â  Â  Â  Â  const tab = document.createElement('div');
Â  Â  Â  Â  Â  Â  tab.className = `tab-item ${idx === curPageIndex ? 'active' : ''}`;
Â  Â  Â  Â  Â  Â  let html = `<span>${page.title}</span>`;
Â  Â  Â  Â  Â  Â  if (idx > 0) html += `<span class="tab-close" onclick="deletePage(event, ${idx})">Ã—</span>`;
Â  Â  Â  Â  Â  Â  tab.innerHTML = html;
Â  Â  Â  Â  Â  Â  tab.onclick = (e) => { if(!e.target.classList.contains('tab-close')) switchPage(idx); };
Â  Â  Â  Â  Â  Â  tab.ondblclick = () => { const t = prompt('íƒ­ ì´ë¦„:', page.title); if(t) { pages[idx].title = t; saveAll(); renderTabs(); } };
Â  Â  Â  Â  Â  Â  topNav.insertBefore(tab, btnAddTab);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  function switchPage(idx) {Â 
Â  Â  Â  Â  if (curPageIndex === 0) pages[0].content = canvasItems; else pages[curPageIndex].content = textInput.value;
Â  Â  Â  Â  saveAll(); curPageIndex = idx; renderTabs(); loadPage(idx);Â 
Â  Â  }
Â  Â  function deletePage(e, idx) { e.stopPropagation(); if(confirm('ì‚­ì œ?')) { pages.splice(idx, 1); if(curPageIndex >= pages.length) curPageIndex = pages.length -1; saveAll(); renderTabs(); loadPage(curPageIndex); } }

Â  Â  function loadPage(idx) {
Â  Â  Â  Â  isPreviewMode = false; markdownPreview.style.display = 'none'; textInput.style.display = 'block'; btnPreview.classList.remove('active');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Tool Box ë²„íŠ¼ ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
Â  Â  Â  Â  const btnUndo = document.getElementById('btnUndo');
Â  Â  Â  Â  const btnRedo = document.getElementById('btnRedo');
Â  Â  Â  Â  const btnResetAll = document.getElementById('btnResetAll');
Â  Â  Â  Â  const undoSep = document.getElementById('undoSep');

Â  Â  Â  Â  if (idx === 0) {
Â  Â  Â  Â  Â  Â  // === ë¹„ì£¼ì–¼ ë³´ë“œ ëª¨ë“œ ===
Â  Â  Â  Â  Â  Â  textEditorArea.style.display = 'none'; canvasArea.style.display = 'block'; btnPreview.style.display = 'none';
Â  Â  Â  Â  Â  Â  document.querySelector('.stats-info').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ë²„íŠ¼ ìƒíƒœ ì œì–´
Â  Â  Â  Â  Â  Â  btnResetAll.style.display = 'flex'; // ì´ˆê¸°í™” ë²„íŠ¼ ë³´ì´ê¸°
Â  Â  Â  Â  Â  Â  btnUndo.style.display = 'none';Â  Â  Â // ì‹¤í–‰ì·¨ì†Œ ìˆ¨ê¸°ê¸°
Â  Â  Â  Â  Â  Â  btnRedo.style.display = 'none';Â  Â  Â // ë‹¤ì‹œì‹¤í–‰ ìˆ¨ê¸°ê¸°
Â  Â  Â  Â  Â  Â  if(undoSep) undoSep.style.display = 'none'; // êµ¬ë¶„ì„  ìˆ¨ê¸°ê¸°

Â  Â  Â  Â  Â  Â  canvasItems = pages[0].content || []; renderCanvasItems();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // === í…ìŠ¤íŠ¸ ì—ë””í„° ëª¨ë“œ ===
Â  Â  Â  Â  Â  Â  canvasArea.style.display = 'none'; textEditorArea.style.display = 'block'; btnPreview.style.display = 'flex';
Â  Â  Â  Â  Â  Â  document.querySelector('.stats-info').style.display = 'flex';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ë²„íŠ¼ ìƒíƒœ ì œì–´
Â  Â  Â  Â  Â  Â  btnResetAll.style.display = 'none'; // ì´ˆê¸°í™” ë²„íŠ¼ ìˆ¨ê¸°ê¸°
Â  Â  Â  Â  Â  Â  btnUndo.style.display = 'flex';Â  Â  Â // ì‹¤í–‰ì·¨ì†Œ ë³´ì´ê¸°
Â  Â  Â  Â  Â  Â  btnRedo.style.display = 'flex';Â  Â  Â // ë‹¤ì‹œì‹¤í–‰ ë³´ì´ê¸°
Â  Â  Â  Â  Â  Â  if(undoSep) undoSep.style.display = 'block'; // êµ¬ë¶„ì„  ë³´ì´ê¸°

Â  Â  Â  Â  Â  Â  textInput.value = pages[idx].content || ''; updateCounts();
Â  Â  Â  Â  }
Â  Â  }
Â  Â  btnAddTab.onclick = () => {Â 
Â  Â  Â  Â  if (curPageIndex === 0) pages[0].content = canvasItems; else pages[curPageIndex].content = textInput.value;
Â  Â  Â  Â  pages.push({ title: `ë…¸íŠ¸ ${pages.length}`, type: 'text', content: '' });Â 
Â  Â  Â  Â  saveAll(); switchPage(pages.length - 1);Â 
Â  Â  };

Â  Â  function renderCanvasItems() {
Â  Â  Â  Â  const existing = canvasArea.querySelectorAll('.item'); existing.forEach(e => e.remove());
Â  Â  Â  Â  canvasItems.forEach(item => {
Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  el.className = `item ${item.id === selectedId ? 'selected' : ''}`;
Â  Â  Â  Â  Â  Â  el.id = `item-${item.id}`;
Â  Â  Â  Â  Â  Â  el.setAttribute('data-title', item.title || "");
Â  Â  Â  Â  Â  Â  el.style.left = item.x + 'px'; el.style.top = item.y + 'px';
Â  Â  Â  Â  Â  Â  el.style.width = item.width + 'px'; el.style.height = item.type === 'image' ? 'auto' : item.height + 'px';
Â  Â  Â  Â  Â  Â  el.style.background = item.type === 'memo' ? item.color : 'transparent';
Â  Â  Â  Â  Â  Â  el.style.zIndex = item.zIndex || 1;
Â  Â  Â  Â  Â  Â  if(item.type === 'memo') el.style.padding = '20px';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const startHandler = (e) => handleCanvasStart(e, item, el);
Â  Â  Â  Â  Â  Â  el.onmousedown = startHandler; el.ontouchstart = startHandler;

Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  html += `<div class="config-panel" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="config-btn" onclick="changeZIndex(${item.id}, 'front')">ë§¨ì•</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="config-btn" onclick="changeZIndex(${item.id}, 'back')">ë§¨ë’¤</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="v-sep"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="config-btn delete-btn" onclick="deleteCanvasItem(${item.id})">ì‚­ì œ</button>`;
Â  Â  Â  Â  Â  Â  if(item.type === 'memo') html += `<div class="v-sep"></div><div class="color-dot" style="background:#fff9c4" onclick="setCanvasColor(${item.id},'#fff9c4')"></div><div class="color-dot" style="background:#b3e5fc" onclick="setCanvasColor(${item.id},'#b3e5fc')"></div><div class="color-dot" style="background:#dcedc8" onclick="setCanvasColor(${item.id},'#dcedc8')"></div><div class="color-dot" style="background:#ffcdd2" onclick="setCanvasColor(${item.id},'#ffcdd2')"></div>`;
Â  Â  Â  Â  Â  Â  html += `</div>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  html += `<div class="tag">${item.title}</div>`;
Â  Â  Â  Â  Â  Â  if(item.type === 'memo') html += `<input class="item-input-title" value="${item.title}" placeholder="ì œëª©" oninput="updateCanvasTitle(${item.id}, this.value)" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()"><textarea class="item-textarea" oninput="updateCanvasContent(${item.id}, this.value)" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()">${item.content}</textarea>`;
Â  Â  Â  Â  Â  Â  else html += `<img src="${item.content}">`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  html += `<div class="resize-handle" onmousedown="startCanvasResize(event, ${item.id})" ontouchstart="startCanvasResize(event, ${item.id})"></div>`;
Â  Â  Â  Â  Â  Â  el.innerHTML = html; canvasArea.appendChild(el);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function getMaxZ() { return Math.max(0, ...canvasItems.map(i => i.zIndex || 1)); }

Â  Â  function addMemoItem() {Â 
Â  Â  Â  Â  const currentScroll = canvasArea.scrollTop;
Â  Â  Â  Â  canvasItems.push({Â 
Â  Â  Â  Â  Â  Â  id: Date.now(), x: 100, y: currentScroll + 100,
Â  Â  Â  Â  Â  Â  width: 260, height: 180,Â 
Â  Â  Â  Â  Â  Â  type: 'memo', title: '', content: '', color: '#fff9c4',
Â  Â  Â  Â  Â  Â  zIndex: getMaxZ() + 1Â 
Â  Â  Â  Â  });Â 
Â  Â  Â  Â  renderCanvasItems(); saveAll();Â 
Â  Â  }
Â  Â Â 
Â  Â  function addCanvasImage(input) {
Â  Â  Â  Â  const file = input.files[0]; if(!file) return;
Â  Â  Â  Â  const currentScroll = canvasArea.scrollTop;
Â  Â  Â  Â  const reader = new FileReader(); reader.onload = (e) => {Â 
Â  Â  Â  Â  Â  Â  canvasItems.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  id: Date.now(), x: 150, y: currentScroll + 150,
Â  Â  Â  Â  Â  Â  Â  Â  width: 300, height: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  type: 'image', content: e.target.result,
Â  Â  Â  Â  Â  Â  Â  Â  zIndex: getMaxZ() + 1
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  renderCanvasItems(); saveAll();Â 
Â  Â  Â  Â  }; reader.readAsDataURL(file); input.value = '';
Â  Â  }
Â  Â Â 
Â  Â  window.changeZIndex = (id, direction) => {
Â  Â  Â  Â  const item = canvasItems.find(i => i.id === id); if(!item) return;
Â  Â  Â  Â  const zIndexes = canvasItems.map(i => i.zIndex || 1);
Â  Â  Â  Â  if (direction === 'front') item.zIndex = Math.max(...zIndexes, 0) + 1;
Â  Â  Â  Â  else item.zIndex = Math.min(...zIndexes, 9999) - 1;
Â  Â  Â  Â  renderCanvasItems(); saveAll();
Â  Â  };

Â  Â  const bgHandler = (e) => { if(e.target===canvasArea) { selectedId=null; renderCanvasItems(); } };
Â  Â  canvasArea.onmousedown = bgHandler; canvasArea.ontouchstart = bgHandler;

Â  Â  function handleCanvasStart(e, item, element) {
Â  Â  Â  Â  if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.closest('.config-panel') || e.target.classList.contains('resize-handle')) return;
Â  Â  Â  Â  if(e.cancelable && !e.target.tagName.match(/INPUT|TEXTAREA/)) { e.preventDefault(); }
Â  Â  Â  Â  selectedId = item.id; draggedItem = item; isDragging = true;
Â  Â  Â  Â  const c = e.type.includes('touch') ? e.changedTouches[0] : e;
Â  Â  Â  Â  startX = c.clientX; startY = c.clientY;Â 
Â  Â  Â  Â  initialX = item.x; initialY = item.y;
Â  Â  Â  Â  renderCanvasItems(); draggedDOM = document.getElementById(`item-${item.id}`);
Â  Â  }

Â  Â  function startCanvasResize(e, id) {
Â  Â  Â  Â  e.stopPropagation();Â 
Â  Â  Â  Â  if(e.type==='touchstart' && e.cancelable) e.preventDefault();
Â  Â  Â  Â  resizeItem = canvasItems.find(i => i.id === id); resizeDOM = document.getElementById(`item-${id}`);
Â  Â  Â  Â  const c = e.type.includes('touch') ? e.changedTouches[0] : e;
Â  Â  Â  Â  startX = c.clientX; startY = c.clientY; initialW = resizeItem.width; initialH = resizeItem.height;
Â  Â  }

Â  Â  const startPanelDrag = (e) => {
Â  Â  Â  Â  if(e.target === btnMinimize) return;
Â  Â  Â  Â  if(e.type === 'touchstart' && e.cancelable) e.preventDefault();
Â  Â  Â  Â  isPanelDragging = true;Â 
Â  Â  Â  Â  const c = e.type.includes('touch') ? e.changedTouches[0] : e;
Â  Â  Â  Â  pStartX = c.clientX; pStartY = c.clientY;
Â  Â  Â  Â  const r = panel.getBoundingClientRect(); pIL = r.left; pIT = r.top;
Â  Â  Â  Â  panel.style.right = 'auto'; panel.style.left = pIL + 'px'; panel.style.top = pIT + 'px';
Â  Â  }
Â  Â  dragHandle.onmousedown = startPanelDrag; dragHandle.ontouchstart = startPanelDrag;

Â  Â  const onGlobalMove = (e) => {
Â  Â  Â  Â  if ((isDragging || resizeItem || isPanelDragging) && e.cancelable) { e.preventDefault(); }
Â  Â  Â  Â  const c = e.type.includes('touch') ? e.changedTouches[0] : e;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(isDragging && curPageIndex === 0 && draggedItem && draggedDOM) {
Â  Â  Â  Â  Â  Â  draggedItem.x = initialX + c.clientX - startX;Â 
Â  Â  Â  Â  Â  Â  draggedItem.y = initialY + c.clientY - startY;
Â  Â  Â  Â  Â  Â  draggedDOM.style.left = draggedItem.x + 'px';Â 
Â  Â  Â  Â  Â  Â  draggedDOM.style.top = draggedItem.y + 'px';
Â  Â  Â  Â  } else if(resizeItem && resizeDOM) {
Â  Â  Â  Â  Â  Â  resizeItem.width = Math.max(50, initialW + c.clientX - startX);Â 
Â  Â  Â  Â  Â  Â  resizeItem.height = Math.max(50, initialH + c.clientY - startY);
Â  Â  Â  Â  Â  Â  resizeDOM.style.width = resizeItem.width + 'px';Â 
Â  Â  Â  Â  Â  Â  if(resizeItem.type !== 'image') resizeDOM.style.height = resizeItem.height + 'px';
Â  Â  Â  Â  } else if (isPanelDragging) {
Â  Â  Â  Â  Â  Â  panel.style.left = (pIL + c.clientX - pStartX) + 'px';Â 
Â  Â  Â  Â  Â  Â  panel.style.top = (pIT + c.clientY - pStartY) + 'px';
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const onGlobalEnd = () => {Â 
Â  Â  Â  Â  if(isDragging || resizeItem) saveAll();Â 
Â  Â  Â  Â  isDragging = false; draggedItem = null; resizeItem = null; draggedDOM = null; resizeDOM = null; isPanelDragging = false;Â 
Â  Â  };
Â  Â Â 
Â  Â  window.addEventListener('mousemove', onGlobalMove); window.addEventListener('mouseup', onGlobalEnd);
Â  Â  window.addEventListener('touchmove', onGlobalMove, {passive: false});Â 
Â  Â  window.addEventListener('touchend', onGlobalEnd);

Â  Â  window.updateCanvasTitle = (id, val) => { const item = canvasItems.find(i => i.id === id); if(item) { item.title = val; const el = document.getElementById(`item-${id}`); if(el) { el.setAttribute('data-title', val); const tag = el.querySelector('.tag'); if(tag) tag.textContent = val; } saveAll(); } };
Â  Â  window.updateCanvasContent = (id, val) => { const item = canvasItems.find(i => i.id === id); if(item) { item.content = val; saveAll(); } };
Â  Â  window.setCanvasColor = (id, color) => { const item = canvasItems.find(i => i.id === id); if(item) { item.color = color; saveAll(); renderCanvasItems(); } };
Â  Â  window.deleteCanvasItem = (id) => { if(confirm('ì‚­ì œ?')) { canvasItems = canvasItems.filter(i => i.id !== id); selectedId = null; saveAll(); renderCanvasItems(); } };

Â  Â  document.getElementById('btnUndo').onclick = () => { if(curPageIndex !== 0 && !isPreviewMode) { document.execCommand('undo'); textInput.focus(); }};
Â  Â  document.getElementById('btnRedo').onclick = () => { if(curPageIndex !== 0 && !isPreviewMode) { document.execCommand('redo'); textInput.focus(); }};
Â  Â  function updateCounts() {
Â  Â  Â  Â  const t = textInput.value; const cjk = (t.match(/[\u3131-\uD79D\uAC00-\uD7A3\u4E00-\u9FFF]/g)||[]).length;
Â  Â  Â  Â  document.getElementById('totalToken').textContent = Math.ceil((cjk*1.1)+((t.length-cjk)*0.25)).toLocaleString();
Â  Â  Â  Â  document.getElementById('totalChar').textContent = t.length.toLocaleString();
Â  Â  Â  Â  const s = textInput.selectionStart, e = textInput.selectionEnd;
Â  Â  Â  Â  const row = document.getElementById('selectionRow');
Â  Â  Â  Â  if(e>s) { row.style.display='flex'; document.getElementById('selectChar').textContent = (e-s).toLocaleString(); } else row.style.display='none';
Â  Â  }
Â  Â  ['input', 'click', 'mouseup', 'keyup'].forEach(ev => textInput.addEventListener(ev, () => { updateCounts(); if(ev === 'input') saveAll(); }));
Â  Â  btnPreview.onclick = () => {Â 
Â  Â  Â  Â  if(curPageIndex === 0) return;
Â  Â  Â  Â  if(typeof marked === 'undefined') { alert('ì¸í„°ë„· ì—°ê²° í™•ì¸'); return; }
Â  Â  Â  Â  if(!isPreviewMode) { markdownPreview.innerHTML = marked.parse(textInput.value); textInput.style.display = 'none'; markdownPreview.style.display = 'block'; btnPreview.classList.add('active'); showToast('ë¯¸ë¦¬ë³´ê¸°'); }Â 
Â  Â  Â  Â  else { markdownPreview.style.display = 'none'; textInput.style.display = 'block'; btnPreview.classList.remove('active'); textInput.focus(); } isPreviewMode = !isPreviewMode;Â 
Â  Â  };
Â  Â  document.getElementById('btnSaveJson').onclick = () => { saveAll(); const blob = new Blob([JSON.stringify({version:3, pages}, null, 2)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Project.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); showToast('íŒŒì¼ ë‚´ë³´ë‚´ê¸°'); };
Â  Â  document.getElementById('btnLoadJson').onclick = () => document.getElementById('fileInput').click();
Â  Â  document.getElementById('fileInput').onchange = (e) => { const f = e.target.files[0]; if(!f) return; if(!confirm('ë®ì–´ì“°ê¸°?')) return; const r = new FileReader(); r.onload = (evt) => { try { const d = JSON.parse(evt.target.result); if(d.pages) { pages = d.pages; curPageIndex = 0; renderTabs(); loadPage(0); saveAll(); showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ'); } } catch(e) { alert('ì˜¤ë¥˜'); } }; r.readAsText(f); e.target.value=''; };
Â  Â Â 
Â  Â  const symbols = ['# ', '- ', '**', '> ', '```', '[]()', 'â†’', 'â†', 'â†”', 'ğŸ¤«', 'â“¤', 'â“’', 'âœ…', 'âŒ', 'âš ï¸', 'ğŸ’‹', 'ğŸ«¦', 'ğŸ”¥', 'ğŸ’¦', 'ğŸ’¤', 'ğŸ“•', 'ğŸ“™', 'ğŸ“—', 'ğŸ“˜', 'Ã—', 'Ã·', 'ã€Œ', 'ã€', 'ã€', 'ã€'];
Â  Â  const sp = document.getElementById('symbolPalette'); symbols.forEach(c => { const b = document.createElement('button'); b.className = 'sym-btn'; b.textContent = c; b.onclick = () => insertSymbol(c); sp.appendChild(b); });
Â  Â  document.getElementById('btnSymbol').onclick = () => sp.classList.toggle('show');
Â  Â  function insertSymbol(c) { if(curPageIndex===0 && selectedId) { const i = canvasItems.find(x=>x.id===selectedId); if(i&&i.type==='memo'){ i.content+=c; document.getElementById(`item-${selectedId}`).querySelector('textarea').value=i.content; saveAll(); } } else if(curPageIndex!==0 && !isPreviewMode) { const s=textInput.selectionStart,e=textInput.selectionEnd,v=textInput.value; textInput.value=v.substring(0,s)+c+v.substring(e); textInput.selectionStart=s+c.length; textInput.focus(); updateCounts(); saveAll(); } }
Â  Â Â 
Â  Â  function showToast(m) { toast.textContent = m; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2500); }
Â  Â  const p = document.getElementById('floatingPanel');
Â  Â  textInput.addEventListener('input', () => p.classList.add('faded'));
Â  Â  textInput.addEventListener('keyup', () => setTimeout(() => p.classList.remove('faded'), 800));

Â  Â  initDB();
</script>
</body>
</html>
